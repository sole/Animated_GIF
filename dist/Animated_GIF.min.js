!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.AnimatedGIF=e()}}(function(){var e,r,a;return function t(e,r,a){function n(o,f){if(!r[o]){if(!e[o]){var l=typeof require=="function"&&require;if(!f&&l)return l(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var v=r[o]={exports:{}};e[o][0].call(v.exports,function(r){var a=e[o][1][r];return n(a?a:r)},v,v.exports,t,e,r,a)}return r[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<a.length;o++)n(a[o]);return n}({1:[function(e,r,a){function t(e,r,a,t){var i=0;var t=t===undefined?{}:t;var o=t.loop===undefined?null:t.loop;var f=t.palette===undefined?null:t.palette;if(r<=0||a<=0||r>65535||a>65535)throw"Width/Height invalid.";function l(e){var r=e.length;if(r<2||r>256||r&r-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return r}e[i++]=71;e[i++]=73;e[i++]=70;e[i++]=56;e[i++]=57;e[i++]=97;var v=0;var u=0;if(f!==null){var s=l(f);while(s>>=1)++v;s=1<<v;--v;if(t.background!==undefined){u=t.background;if(u>=s)throw"Background index out of range.";if(u===0)throw"Background index explicitly passed as 0."}}e[i++]=r&255;e[i++]=r>>8&255;e[i++]=a&255;e[i++]=a>>8&255;e[i++]=(f!==null?128:0)|v;e[i++]=u;e[i++]=0;if(f!==null){for(var h=0,d=f.length;h<d;++h){var c=f[h];e[i++]=c>>16&255;e[i++]=c>>8&255;e[i++]=c&255}}if(o!==null){if(o<0||o>65535)throw"Loop count invalid.";e[i++]=33;e[i++]=255;e[i++]=11;e[i++]=78;e[i++]=69;e[i++]=84;e[i++]=83;e[i++]=67;e[i++]=65;e[i++]=80;e[i++]=69;e[i++]=50;e[i++]=46;e[i++]=48;e[i++]=3;e[i++]=1;e[i++]=o&255;e[i++]=o>>8&255;e[i++]=0}var g=false;this.addFrame=function(r,a,t,o,v,u){if(g===true){--i;g=false}u=u===undefined?{}:u;if(r<0||a<0||r>65535||a>65535)throw"x/y invalid.";if(t<=0||o<=0||t>65535||o>65535)throw"Width/Height invalid.";if(v.length<t*o)throw"Not enough pixels for the frame size.";var s=true;var h=u.palette;if(h===undefined||h===null){s=false;h=f}if(h===undefined||h===null)throw"Must supply either a local or global palette.";var d=l(h);var c=0;while(d>>=1)++c;d=1<<c;var p=u.delay===undefined?0:u.delay;var w=u.disposal===undefined?0:u.disposal;if(w<0||w>3)throw"Disposal out of range.";var m=false;var b=0;if(u.transparent!==undefined&&u.transparent!==null){m=true;b=u.transparent;if(b<0||b>=d)throw"Transparent color index."}if(w!==0||m||p!==0){e[i++]=33;e[i++]=249;e[i++]=4;e[i++]=w<<2|(m===true?1:0);e[i++]=p&255;e[i++]=p>>8&255;e[i++]=b;e[i++]=0}e[i++]=44;e[i++]=r&255;e[i++]=r>>8&255;e[i++]=a&255;e[i++]=a>>8&255;e[i++]=t&255;e[i++]=t>>8&255;e[i++]=o&255;e[i++]=o>>8&255;e[i++]=s===true?128|c-1:0;if(s===true){for(var y=0,x=h.length;y<x;++y){var k=h[y];e[i++]=k>>16&255;e[i++]=k>>8&255;e[i++]=k&255}}i=n(e,i,c<2?2:c,v)};this.end=function(){if(g===false){e[i++]=59;g=true}return i}}function n(e,r,a,t){e[r++]=a;var n=r++;var i=1<<a;var o=i-1;var f=i+1;var l=f+1;var v=a+1;var u=0;var s=0;function h(a){while(u>=a){e[r++]=s&255;s>>=8;u-=8;if(r===n+256){e[n]=255;n=r++}}}function d(e){s|=e<<u;u+=v;h(8)}var c=t[0]&o;var g={};d(i);for(var p=1,w=t.length;p<w;++p){var m=t[p]&o;var b=c<<8|m;var y=g[b];if(y===undefined){s|=c<<u;u+=v;while(u>=8){e[r++]=s&255;s>>=8;u-=8;if(r===n+256){e[n]=255;n=r++}}if(l===4096){d(i);l=f+1;v=a+1;g={}}else{if(l>=1<<v)++v;g[b]=l++}c=m}else{c=y}}d(c);d(f);h(1);if(n+1===r){e[n]=0}else{e[n]=r-n-1;e[r++]=0}return r}function i(e){var r=0;if(e[r++]!==71||e[r++]!==73||e[r++]!==70||e[r++]!==56||(e[r++]+1&253)!==56||e[r++]!==97){throw"Invalid GIF 87a/89a header."}var a=e[r++]|e[r++]<<8;var t=e[r++]|e[r++]<<8;var n=e[r++];var i=n>>7;var f=n&7;var l=1<<f+1;var v=e[r++];e[r++];var u=null;if(i){u=r;r+=l*3}var s=true;var h=[];var d=0;var c=null;var g=0;var p=null;this.width=a;this.height=t;while(s&&r<e.length){switch(e[r++]){case 33:switch(e[r++]){case 255:if(e[r]!==11||e[r+1]==78&&e[r+2]==69&&e[r+3]==84&&e[r+4]==83&&e[r+5]==67&&e[r+6]==65&&e[r+7]==80&&e[r+8]==69&&e[r+9]==50&&e[r+10]==46&&e[r+11]==48&&e[r+12]==3&&e[r+13]==1&&e[r+16]==0){r+=14;p=e[r++]|e[r++]<<8;r++}else{r+=12;while(true){var w=e[r++];if(w===0)break;r+=w}}break;case 249:if(e[r++]!==4||e[r+4]!==0)throw"Invalid graphics extension block.";var m=e[r++];d=e[r++]|e[r++]<<8;c=e[r++];if((m&1)===0)c=null;g=m>>2&7;r++;break;case 254:while(true){var w=e[r++];if(w===0)break;r+=w}break;default:throw"Unknown graphic control label: 0x"+e[r-1].toString(16)}break;case 44:var b=e[r++]|e[r++]<<8;var y=e[r++]|e[r++]<<8;var x=e[r++]|e[r++]<<8;var k=e[r++]|e[r++]<<8;var I=e[r++];var F=I>>7;var A=I>>6&1;var _=I&7;var P=1<<_+1;var G=u;var B=false;if(F){var B=true;G=r;r+=P*3}var W=r;r++;while(true){var w=e[r++];if(w===0)break;r+=w}h.push({x:b,y:y,width:x,height:k,has_local_palette:B,palette_offset:G,data_offset:W,data_length:r-W,transparent_index:c,interlaced:!!A,delay:d,disposal:g});break;case 59:s=false;break;default:throw"Unknown gif block: 0x"+e[r-1].toString(16);break}}this.numFrames=function(){return h.length};this.loopCount=function(){return p};this.frameInfo=function(e){if(e<0||e>=h.length)throw"Frame index out of range.";return h[e]};this.decodeAndBlitFrameBGRA=function(r,t){var n=this.frameInfo(r);var i=n.width*n.height;var f=new Uint8Array(i);o(e,n.data_offset,f,i);var l=n.palette_offset;var v=n.transparent_index;if(v===null)v=256;var u=n.width;var s=a-u;var h=u;var d=(n.y*a+n.x)*4;var c=((n.y+n.height)*a+n.x)*4;var g=d;var p=s*4;if(n.interlaced===true){p+=a*4*7}var w=8;for(var m=0,b=f.length;m<b;++m){var y=f[m];if(h===0){g+=p;h=u;if(g>=c){p=s*4+a*4*(w-1);g=d+(u+s)*(w<<1);w>>=1}}if(y===v){g+=4}else{var x=e[l+y*3];var k=e[l+y*3+1];var I=e[l+y*3+2];t[g++]=I;t[g++]=k;t[g++]=x;t[g++]=255}--h}};this.decodeAndBlitFrameRGBA=function(r,t){var n=this.frameInfo(r);var i=n.width*n.height;var f=new Uint8Array(i);o(e,n.data_offset,f,i);var l=n.palette_offset;var v=n.transparent_index;if(v===null)v=256;var u=n.width;var s=a-u;var h=u;var d=(n.y*a+n.x)*4;var c=((n.y+n.height)*a+n.x)*4;var g=d;var p=s*4;if(n.interlaced===true){p+=a*4*7}var w=8;for(var m=0,b=f.length;m<b;++m){var y=f[m];if(h===0){g+=p;h=u;if(g>=c){p=s*4+a*4*(w-1);g=d+(u+s)*(w<<1);w>>=1}}if(y===v){g+=4}else{var x=e[l+y*3];var k=e[l+y*3+1];var I=e[l+y*3+2];t[g++]=x;t[g++]=k;t[g++]=I;t[g++]=255}--h}}}function o(e,r,a,t){var n=e[r++];var i=1<<n;var o=i+1;var f=o+1;var l=n+1;var v=(1<<l)-1;var u=0;var s=0;var h=0;var d=e[r++];var c=new Int32Array(4096);var g=null;while(true){while(u<16){if(d===0)break;s|=e[r++]<<u;u+=8;if(d===1){d=e[r++]}else{--d}}if(u<l)break;var p=s&v;s>>=l;u-=l;if(p===i){f=o+1;l=n+1;v=(1<<l)-1;g=null;continue}else if(p===o){break}var w=p<f?p:g;var m=0;var b=w;while(b>i){b=c[b]>>8;++m}var y=b;var x=h+m+(w!==p?1:0);if(x>t){console.log("Warning, gif stream longer than expected.");return}a[h++]=y;h+=m;var k=h;if(w!==p)a[h++]=y;b=w;while(m--){b=c[b];a[--k]=b&255;b>>=8}if(g!==null&&f<4096){c[f++]=g<<8|y;if(f>=v+1&&l<12){++l;v=v<<1|1}}g=p}if(h!==t){console.log("Warning, gif stream shorter than expected.")}return a}try{a.GifWriter=t;a.GifReader=i}catch(f){}},{}],2:[function(e,r,a){function t(r){"use strict";var a=e("omggif").GifWriter;var t=r.width||160;var n=r.height||120;var i=r.dithering||null;var o=r.palette||null;var f=null,l=null,v=0,u=250;var s=[];var h=0;var d=function(){};var c=function(){};var g;var p=[],w=[],m,b;var y=false;if(o){if(!(o instanceof Array)){throw"Palette MUST be an array but it is: ",o}else{if(o.length<2||o.length>256){console.error("Palette must hold only between 2 and 256 colours");while(o.length<2){o.push(0)}if(o.length>256){o=o.slice(0,256)}}if(!U(o.length)){console.error("Palette must have a power of two number of colours");while(!U(o.length)){o.splice(o.length-1,1)}}}}r=r||{};g=r.sampleInterval||10;m=r.numWorkers||2;b=r.workerPath||"Animated_GIF.worker.js";for(var x=0;x<m;x++){var k=new Worker(b);p.push(k);w.push(k)}function I(){if(w.length===0){throw"No workers left!"}return w.pop()}function F(e){w.push(e)}var A=function(){var e=[];for(var r=0;r<256;r++){e[r]=String.fromCharCode(r)}return function(r){var a=r.length;var t="";for(var n=0;n<a;n++){t+=e[r[n]]}return t}}();function _(e){var r=s.length;d=e;for(var a=0;a<m&&a<s.length;a++){P(a)}}function P(e){var r;var a;r=s[e];if(r.beingProcessed||r.done){console.error("Frame already being processed or done!",r.position);B();return}r.sampleInterval=g;r.beingProcessed=true;a=I();a.onmessage=function(e){var t=e.data;delete r.data;r.pixels=Array.prototype.slice.call(t.pixels);r.palette=Array.prototype.slice.call(t.palette);r.done=true;r.beingProcessed=false;F(a);B()};a.postMessage(r)}function G(){var e=-1;for(var r=0;r<s.length;r++){var a=s[r];if(!a.done&&!a.beingProcessed){e=r;break}}if(e>=0){P(e)}}function B(){var e=s.every(function(e){return!e.beingProcessed&&e.done});h++;c(h*.75/s.length);if(e){if(!y){W(s,d)}}else{setTimeout(G,1)}}function W(e,r){var f=[];var l;var s={loop:v};if(i!==null&&o!==null){l=o;s.palette=l}var h=new a(f,t,n,s);y=true;e.forEach(function(r,a){var i;if(!l){i=r.palette}c(.75+.25*r.position*1/e.length);h.addFrame(0,0,t,n,r.pixels,{palette:i,delay:u})});h.end();c(1);e=[];y=false;r(f)}function U(e){return e!==0&&(e&e-1)===0}this.setSize=function(e,r){t=e;n=r;f=document.createElement("canvas");f.width=e;f.height=r;l=f.getContext("2d")};this.setDelay=function(e){u=e*.1};this.setRepeat=function(e){v=e};this.addFrame=function(e){if(l===null){this.setSize(t,n)}l.drawImage(e,0,0,t,n);var r=l.getImageData(0,0,t,n);this.addFrameImageData(r)};this.addFrameImageData=function(e){var r=e.length,a=new Uint8Array(e.data);s.push({data:a,width:e.width,height:e.height,palette:o,dithering:i,done:false,beingProcessed:false,position:s.length})};this.onRenderProgress=function(e){c=e};this.isRendering=function(){return y};this.getBase64GIF=function(e){var r=function(r){var a=A(r);var t="data:image/gif;base64,"+btoa(a);e(t)};_(r)};this.getBlobGIF=function(e){var r=function(r){var a=new Uint8Array(r);var t=new Blob([a],{type:"image/gif"});e(t)};_(r)};this.destroy=function(){p.forEach(function(e){e.terminate()})}}r.exports=t},{omggif:1}]},{},[2])(2)});
